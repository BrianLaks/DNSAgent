<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css?v=@DateTime.Now.Ticks" />
    <link rel="stylesheet" href="DNSAgent.Service.styles.css?v=@DateTime.Now.Ticks" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet @rendermode="InteractiveServer" />
</head>

<body>
    <Routes />
    <script>
        window.clipboardCopy = {
            copyText: function(text) {
                navigator.clipboard.writeText(text).then(function () {
                    alert("Copied to clipboard!");
                })
                .catch(function (error) {
                    alert("Error copying text: " + error);
                });
            }
        };
    </script>
    <script src="lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="_framework/blazor.web.js"></script>
    <script>
        // Blazor Enhanced Navigation fix for Bootstrap
        Blazor.addEventListener('enhancedload', () => {
            // Re-initialize Bootstrap accordions/dropdowns
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        });

        window.renderReportsCharts = (hours, values, blocked, allowed) => {
            const hourlyOptions = {
                series: [{ name: 'Queries', data: values }],
                chart: { height: 350, type: 'area', toolbar: { show: false }, zoom: { enabled: false } },
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: { categories: hours.map(h => `${h}:00`) },
                colors: ['#007bff'],
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.45, opacityTo: 0.05 } }
            };
            if (window.hourlyChartInstance) window.hourlyChartInstance.destroy();
            window.hourlyChartInstance = new ApexCharts(document.querySelector("#hourlyChart"), hourlyOptions);
            window.hourlyChartInstance.render();

            const distOptions = {
                series: [allowed, blocked],
                labels: ['Allowed', 'Blocked'],
                chart: { type: 'donut', height: 300 },
                colors: ['#28a745', '#dc3545'],
                legend: { position: 'bottom' },
                plotOptions: { pie: { donut: { labels: { show: true, total: { show: true } } } } }
            };
            if (window.distChartInstance) window.distChartInstance.destroy();
            window.distChartInstance = new ApexCharts(document.querySelector("#distributionChart"), distOptions);
            window.distChartInstance.render();
        };
    </script>
</body>

</html>
