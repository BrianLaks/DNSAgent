<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css?v=@DateTime.Now.Ticks" />
    <link rel="stylesheet" href="DNSAgent.Service.styles.css?v=@DateTime.Now.Ticks" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet @rendermode="InteractiveServer" />
</head>

<body>
    <Routes />
    <script>
        window.clipboardCopy = {
            copyText: function(text) {
                navigator.clipboard.writeText(text).then(function () {
                    alert("Copied to clipboard!");
                })
                .catch(function (error) {
                    alert("Error copying text: " + error);
                });
            }
        };
    </script>
    <script src="lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="_framework/blazor.web.js"></script>
    <script>
        // Blazor Enhanced Navigation fix for Bootstrap
        Blazor.addEventListener('enhancedload', () => {
            // Re-initialize Bootstrap accordions/dropdowns
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        });

        const getThemeColors = () => {
            const styles = getComputedStyle(document.querySelector('.page') || document.body);
            return {
                primary: styles.getPropertyValue('--brand-primary').trim() || '#007bff',
                accent: styles.getPropertyValue('--brand-accent').trim() || '#6f42c1',
                success: '#28a745', // Keep standard or make variable if needed
                danger: '#dc3545',   // Keep standard
                warning: '#ffc107',
                info: '#17a2b8'
            };
        };

        window.renderReportsCharts = (hours, values, blocked, allowed) => {
            const colors = getThemeColors();
            const hourlyOptions = {
                series: [{ name: 'Queries', data: values }],
                chart: { height: 350, type: 'area', toolbar: { show: false }, zoom: { enabled: false } },
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: { categories: hours },
                colors: [colors.primary],
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.6, opacityTo: 0.1 } },
                grid: { borderColor: 'rgba(255,255,255,0.1)' },
                theme: { mode: 'dark' } 
            };
            if (window.hourlyChartInstance) window.hourlyChartInstance.destroy();
            window.hourlyChartInstance = new ApexCharts(document.querySelector("#hourlyChart"), hourlyOptions);
            window.hourlyChartInstance.render();

            const distOptions = {
                series: [allowed, blocked],
                labels: ['Allowed', 'Blocked'],
                chart: { type: 'donut', height: 300 },
                colors: [colors.primary, colors.danger], // Use primary for allowed 'good' state in neural theme
                legend: { position: 'bottom', labels: { colors: '#fff' } },
                plotOptions: { pie: { donut: { labels: { show: true, total: { show: true, color: '#fff' } } } } },
                stroke: { show: true, colors: ['#000'], width: 2 }
            };
            if (window.distChartInstance) window.distChartInstance.destroy();
            window.distChartInstance = new ApexCharts(document.querySelector("#distributionChart"), distOptions);
            window.distChartInstance.render();
        };

        window.renderDetailedReports = (trafficLabels, trafficData, youtubeLabels, adsData, sponsorsData, securityLabels, securityData, deviceLabels, deviceData) => {
            const colors = getThemeColors();
            
            // 1. Traffic Trend (7 Days)
            const trafficOptions = {
                series: [{ name: 'Queries', data: trafficData }],
                chart: { height: 350, type: 'line', toolbar: { show: true } },
                stroke: { curve: 'smooth', width: 3 },
                xaxis: { categories: trafficLabels, labels: { style: { colors: '#aaa' } } },
                yaxis: { labels: { style: { colors: '#aaa' } } },
                colors: [colors.primary],
                markers: { size: 4 },
                grid: { borderColor: 'rgba(255,255,255,0.1)' },
                theme: { mode: 'dark' }
            };
            const trafficEl = document.querySelector("#trafficTrendChart");
            if (trafficEl) {
                if (window.trafficChart) window.trafficChart.destroy();
                window.trafficChart = new ApexCharts(trafficEl, trafficOptions);
                window.trafficChart.render();
            }

            // 2. YouTube Trend
            const ytOptions = {
                series: [
                    { name: 'Ads Blocked', data: adsData },
                    { name: 'Sponsors Skipped', data: sponsorsData }
                ],
                chart: { height: 300, type: 'bar', stacked: true },
                xaxis: { categories: youtubeLabels, labels: { style: { colors: '#aaa' } } },
                yaxis: { labels: { style: { colors: '#aaa' } } },
                colors: [colors.danger, '#6c757d'],
                grid: { borderColor: 'rgba(255,255,255,0.1)' },
                legend: { labels: { colors: '#fff' } },
                theme: { mode: 'dark' }
            };
            const ytEl = document.querySelector("#youtubeTrendChart");
            if (ytEl) {
                if (window.ytChart) window.ytChart.destroy();
                window.ytChart = new ApexCharts(ytEl, ytOptions);
                window.ytChart.render();
            }

            // 3. Security Pie
            const secOptions = {
                series: securityData,
                labels: securityLabels,
                chart: { type: 'pie', height: 300 },
                colors: [colors.success, colors.warning, colors.info],
                legend: { position: 'bottom', labels: { colors: '#fff' } },
                stroke: { show: true, colors: ['#000'], width: 2 }
            };
            const secEl = document.querySelector("#securityPieChart");
            if (secEl) {
                if (window.secChart) window.secChart.destroy();
                window.secChart = new ApexCharts(secEl, secOptions);
                window.secChart.render();
            }

            // 4. Device Volume
            const devOptions = {
                series: [{ name: 'Queries', data: deviceData }],
                chart: { type: 'bar', height: 350 },
                plotOptions: { bar: { horizontal: true } },
                xaxis: { categories: deviceLabels, labels: { style: { colors: '#aaa' } } },
                yaxis: { labels: { style: { colors: '#fff' } } },
                colors: [colors.accent],
                grid: { borderColor: 'rgba(255,255,255,0.1)' },
                theme: { mode: 'dark' }
            };
            const devEl = document.querySelector("#deviceVolumeChart");
            if (devEl) {
                if (window.devChart) window.devChart.destroy();
                window.devChart = new ApexCharts(devEl, devOptions);
                window.devChart.render();
            }
        };
    </script>
</body>

</html>
