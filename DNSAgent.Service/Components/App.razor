<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css?v=@DateTime.Now.Ticks" />
    <link rel="stylesheet" href="DNSAgent.Service.styles.css?v=@DateTime.Now.Ticks" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet @rendermode="InteractiveServer" />
</head>

<body>
    <Routes />
    <script>
        window.clipboardCopy = {
            copyText: function(text) {
                navigator.clipboard.writeText(text).then(function () {
                    alert("Copied to clipboard!");
                })
                .catch(function (error) {
                    alert("Error copying text: " + error);
                });
            }
        };
    </script>
    <script src="lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="_framework/blazor.web.js"></script>
    <script>
        // Blazor Enhanced Navigation fix for Bootstrap
        Blazor.addEventListener('enhancedload', () => {
            // Re-initialize Bootstrap accordions/dropdowns
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        });

        window.renderReportsCharts = (hours, values, blocked, allowed) => {
            const hourlyOptions = {
                series: [{ name: 'Queries', data: values }],
                chart: { height: 350, type: 'area', toolbar: { show: false }, zoom: { enabled: false } },
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: { categories: hours },
                colors: ['#007bff'],
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.45, opacityTo: 0.05 } }
            };
            if (window.hourlyChartInstance) window.hourlyChartInstance.destroy();
            window.hourlyChartInstance = new ApexCharts(document.querySelector("#hourlyChart"), hourlyOptions);
            window.hourlyChartInstance.render();

            const distOptions = {
                series: [allowed, blocked],
                labels: ['Allowed', 'Blocked'],
                chart: { type: 'donut', height: 300 },
                colors: ['#28a745', '#dc3545'],
                legend: { position: 'bottom' },
                plotOptions: { pie: { donut: { labels: { show: true, total: { show: true } } } } }
            };
            if (window.distChartInstance) window.distChartInstance.destroy();
            window.distChartInstance = new ApexCharts(document.querySelector("#distributionChart"), distOptions);
            window.distChartInstance.render();
        };

        window.renderDetailedReports = (trafficLabels, trafficData, youtubeLabels, adsData, sponsorsData, securityLabels, securityData, deviceLabels, deviceData) => {
            // 1. Traffic Trend (7 Days)
            const trafficOptions = {
                series: [{ name: 'Queries', data: trafficData }],
                chart: { height: 350, type: 'line', toolbar: { show: true } },
                stroke: { curve: 'smooth', width: 3 },
                xaxis: { categories: trafficLabels },
                colors: ['#007bff'],
                markers: { size: 4 }
            };
            const trafficEl = document.querySelector("#trafficTrendChart");
            if (trafficEl) {
                if (window.trafficChart) window.trafficChart.destroy();
                window.trafficChart = new ApexCharts(trafficEl, trafficOptions);
                window.trafficChart.render();
            }

            // 2. YouTube Trend
            const ytOptions = {
                series: [
                    { name: 'Ads Blocked', data: adsData },
                    { name: 'Sponsors Skipped', data: sponsorsData }
                ],
                chart: { height: 300, type: 'bar', stacked: true },
                xaxis: { categories: youtubeLabels },
                colors: ['#ff0000', '#000000']
            };
            const ytEl = document.querySelector("#youtubeTrendChart");
            if (ytEl) {
                if (window.ytChart) window.ytChart.destroy();
                window.ytChart = new ApexCharts(ytEl, ytOptions);
                window.ytChart.render();
            }

            // 3. Security Pie
            const secOptions = {
                series: securityData,
                labels: securityLabels,
                chart: { type: 'pie', height: 300 },
                colors: ['#28a745', '#ffc107', '#17a2b8']
            };
            const secEl = document.querySelector("#securityPieChart");
            if (secEl) {
                if (window.secChart) window.secChart.destroy();
                window.secChart = new ApexCharts(secEl, secOptions);
                window.secChart.render();
            }

            // 4. Device Volume
            const devOptions = {
                series: [{ name: 'Queries', data: deviceData }],
                chart: { type: 'bar', height: 350 },
                plotOptions: { bar: { horizontal: true } },
                xaxis: { categories: deviceLabels },
                colors: ['#6f42c1']
            };
            const devEl = document.querySelector("#deviceVolumeChart");
            if (devEl) {
                if (window.devChart) window.devChart.destroy();
                window.devChart = new ApexCharts(devEl, devOptions);
                window.devChart.render();
            }
        };
    </script>
</body>

</html>
